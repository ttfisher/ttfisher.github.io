---
title: MySQL菜鸟实录（三）：my.cnf扩展
categories:
  - 数据库技能储备之MySQL实战
tags:
  - MySQL
comments: true
copyright: true
abbrlink: 1dea5437
date: 2019-03-06 16:15:13
---
【引言】
<div align=center><img src="https://github.com/ttfisher/images/raw/master/2019/2018-11-13-02.jpg" width="500"/></div>
<!-- more -->

# 握手

# mysqld和mysqld_safe

# Socket和TCP/IP
&emsp;&emsp;在unix/linux系统上，MySQL的登录方式有两种，分别是socket和tcp/ip。
&emsp;&emsp;当连接不指定参数时默认使用socket连接登录MySQL服务（实际上是缺省了-S socketPath），比如下面这样子；
```
[root@mysql ~]# mysql
Welcome to the MySQL monitor.  Commands end with ; or \g.
......
```
&emsp;&emsp;如果配置文件my.cnf的[client]中指定了socket配置，那么会按照指定的路径去寻找socket套接字，若是没有指定socket文件路径时，mysql默认会去寻找/tmp/mysql.sock，所以这里必须要保证在MySQL服务启动的时候，生成的socket文件必须和[client]中配置的一致，否则登录时就会报错。
```
[root@mysql ~]# mysql
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock' (2)
```
&emsp;&emsp;那什么时候用tcp/ip连接呢？在使用mysql命令登录的时候，若指定了-h参数，则会使用tcp/ip的方式连接，如果此时没有指定端口的话，默认会使用3306端口：
```
[root@mysql ~]# mysql -h192.168.1.211
Welcome to the MySQL monitor.  Commands end with ; or \g.
......
```

# max_user_connections VS max_connections
https://www.jianshu.com/p/0996057d9593
https://www.cnblogs.com/arcer/p/5559252.html
https://www.cnblogs.com/musings/p/5930358.html

# max_connect_errors
&emsp;&emsp;错误信息形如：ERROR 1129 (00000): Host 'xxx' is blocked because of many connection errors. Unblock with 'mysqladmin flush-hosts'
https://www.cnblogs.com/kerrycode/p/8405862.html

# 几个timeout
https://blog.csdn.net/u010027484/article/details/58585589

# back_log
https://www.cnblogs.com/mydriverc/p/8296814.html

# max_allowed_packet
https://www.jianshu.com/p/629685b97030

# query_cache_xxx

查询缓存碎片率 = Qcache_free_blocks / Qcache_total_blocks * 100%
如果查询缓存碎片率超过 20%，可以用 FLUSH QUERY CACHE 整理缓存碎片，或者试试减小query_cache_min_res_unit，如果你的查询都是小数据量的话。
查询缓存利用率 = (query_cache_size – Qcache_free_memory) / query_cache_size *100%
查询缓存利用率在 25%以下的话说明 query_cache_size 设置的过大，可适当减小;查询缓存利用率在 80%以上而且 Qcache_lowmem_prunes > 50 的话说明 query_cache_size 可能有点小，要不就是碎片太多。
查询缓存命中率 = (Qcache_hits – Qcache_inserts) / Qcache_hits * 100%
query_cache_min_res_unit = 2K 

可以通过在 MySQL 控制台执行以下命令观察：
代码:
> SHOW VARIABLES LIKE '%query_cache%';
> SHOW STATUS LIKE 'Qcache%';如果 Qcache_lowmem_prunes 的值非常大，则表明经常出现缓冲不够的情况；
如果 Qcache_hits 的值非常大，则表明查询缓冲使用非常频繁，如果该值较小反而会影响效率，那么可以考虑不用查询缓冲； Qcache_free_blocks，如果该值非常大，则表明缓冲区中碎片很多。
memlock # 如果你的系统支持 memlock() 函数,你也许希望打开此选项用以让运行中的 mysql 在在内存高度
紧张的时候,数据在内存中保持锁定并且防止可能被 swapping out,此选项对于性能有益
query_cache_size = 64M  


# binlog_cache_size
在一个事务中 binlog 为了记录 SQL 状态所持有的 cache 大小,如果你经常使用大的,多声明的事务,你可以增加此值来获取更大的性能.所有从事务来的状态都将被缓冲在 binlog 缓冲中然后在提交后一次性写入到 binlog 中,如果事务比此值大, 会使用磁盘上的临时文件来替代.此缓冲在每个连接的事务第一次更新状态时被创建.session 级别
binlog_cache_size = 1M 