---
title: 运维监控工具（二）：Zabbix环境搭建
categories:
  - 架构师野蛮生长之系统运维
tags:
  - Zabbix
  - 运维
abbrlink: 76d830ce
date: 2018-11-30 09:03:00
---
【引言】按照以往的惯例，一切工具的使用都需要有一套可使用的环境，所以此次对Zabbix的探索还是从环境搭建开始。搭完环境，基本上对工具也有了初步的认识了。
<div align=center><img src="https://github.com/ttfisher/images/raw/master/2018/2018-11-30-02.jpg" width="500"/></div>
<!-- more -->

# 前言
&emsp;&emsp;Zabbix作为一个监控工具，我们很容易想到基本模式肯定是一个服务端做管理和分析，N个客户端做信息收集这种模式；这里主要还是讲一下服务端的安装。

# 记录
```bash
Last login: Thu Nov 29 20:13:33 2018 from 192.168.1.137
[root@localhost ~]# systemctl stop firewalld.service
[root@localhost ~]# systemctl disable firewalld.service
# SELINUX=disabled
[root@localhost ~]# vi /etc/selinux/config
[root@localhost ~]# ls -l /etc/yum.repos.d/
total 32
-rw-r--r--. 1 root root 2523 Oct 19 23:01 CentOS-Base.repo
-rw-r--r--. 1 root root 1309 Apr 28  2018 CentOS-CR.repo
-rw-r--r--. 1 root root  649 Apr 28  2018 CentOS-Debuginfo.repo
-rw-r--r--. 1 root root  314 Apr 28  2018 CentOS-fasttrack.repo
-rw-r--r--. 1 root root  630 Apr 28  2018 CentOS-Media.repo
-rw-r--r--. 1 root root 1331 Apr 28  2018 CentOS-Sources.repo
-rw-r--r--. 1 root root 4768 Apr 28  2018 CentOS-Vault.repo
# use aliyun -> http://mirrors.aliyun.com/repo/
[root@localhost ~]# cat /etc/yum.repos.d/CentOS-Base.repo
# CentOS-Base.repo
..................................................
[root@localhost ~]# 
[root@localhost ~]# yum install mariadb-server mariadb
Loaded plugins: fastestmirror
Determining fastest mirrors
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
base            | 3.6 kB  00:00:00     
extras          | 3.4 kB  00:00:00     
updates         | 3.4 kB  00:00:00     
(1/2): extras/7/x86_64/primary_db           | 205 kB  00:00:00     
(2/2): updates/7/x86_64/primary_db          | 6.0 MB  00:00:01     
Resolving Dependencies
--> Running transaction check
..................................................

Complete!
[root@localhost ~]# mysqladmin -u root password "Smart123"
mysqladmin: connect to server at 'localhost' failed
error: Can not connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)
Check that mysqld is running and that the socket: '/var/lib/mysql/mysql.sock' exists!
[root@localhost ~]# 
[root@localhost ~]# systemctl start mariadb
[root@localhost ~]# 
[root@localhost ~]# mysqladmin -u root password "Smart123"
[root@localhost ~]# mysql -uroot -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 3
Server version: 5.5.60-MariaDB MariaDB Server

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> create database zabbix character set utf8 collate utf8_bin;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
| zabbix             |
+--------------------+
5 rows in set (0.00 sec)

MariaDB [(none)]> exit
Bye
[root@localhost ~]# rpm -i http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm
warning: /var/tmp/rpm-tmp.C921X4: Header V4 RSA/SHA512 Signature, key ID a14fe591: NOKEY
[root@localhost ~]# yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent 
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
zabbix                                 | 2.9 kB  00:00:00     
zabbix-non-supported                   |  951 B  00:00:00     
zabbix/x86_64/primary_db               | 118 kB  00:00:03     
zabbix-non-supported/x86_64/primary    | 1.6 kB  00:00:00     
zabbix-non-supported               4/4
Resolving Dependencies
--> Running transaction check
..................................................
Complete!
[root@localhost ~]# yum install zabbix-get zabbix-sender zabbix-java-gateway
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Resolving Dependencies
--> Running transaction check
..................................................
Complete!
[root@localhost ~]# zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix
Enter password: 
[root@localhost ~]# vim /etc/zabbix/zabbix_server.conf  
[root@localhost ~]# systemctl enable zabbix-server
Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-server.service to /usr/lib/systemd/system/zabbix-server.service.
[root@localhost ~]# systemctl start zabbix-server
[root@localhost ~]# systemctl enable zabbix-agent
Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.
[root@localhost ~]# systemctl start zabbix-agent
[root@localhost ~]# 
# php_value date.timezone Asia/Shanghai
[root@localhost ~]# vim /etc/httpd/conf.d/zabbix.conf
[root@localhost ~]# systemctl start httpd
[root@localhost ~]# 　　systemctl enable httpd
-bash: 　　systemctl: command not found
[root@localhost ~]# 
[root@localhost ~]# systemctl enable httpd
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
[root@localhost ~]# mysql -uroot -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 22
Server version: 5.5.60-MariaDB MariaDB Server

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> use mysql
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [mysql]> update user set host = '%' where user ='root';
ERROR 1062 (23000): Duplicate entry '%-root' for key 'PRIMARY'
MariaDB [mysql]> flush privileges;
Query OK, 0 rows affected (0.00 sec)
```
