---
title: 网红技术区块链入门（四）：区块链的进一步拓展-以太坊
comments: true
categories:
  - 【401】睁眼看世界之新技术的崛起
tags:
  - 区块链
abbrlink: a5566412
date: 2018-06-05 14:33:36
---
【引言】在区块链领域，以太坊项目同样是十分出名的开源项目。作为公有区块链平台，以太坊将比特币针对数字货币交易的功能进一步进行拓展，面向更为复杂和灵活的应用场景，支持了智能合约（Smart Contract）这一重要特性。
<img style="clear: both;display: block;margin:auto;" src="/img/2018/2018-06-05-12.jpg" width="500">
<!-- more -->

# 以太坊是什么？
&emsp;&emsp;以太坊（英语：Ethereum）是一个开源的有智能合约功能的公共区块链平台。通过其专用加密货币以太币（Ether）提供去中心化的虚拟机（“以太虚拟机” Ethereum Virtual Machine）来处理点对点合约。相对比特币网络自 2009 年上线的历史，以太坊项目要年轻的多（以太坊区块链网络的正式上线时间在2015年7月）。
&emsp;&emsp;以太坊（Ethereum）项目的最初目标，是打造一个运行智能合约的平台（Platform for Smart Contract）。该平台支持图灵完备的应用，按照智能合约的约定逻辑自动执行，理想情况下将不存在故障停机、审查、欺诈，以及第三方干预等问题。
&emsp;&emsp;以太坊项目未来希望通过分片（sharding）机制来提高整个网络的扩展性。分片后，同一片内的合约处理是同步的，彼此达成共识，不同分片之间则可以是异步的，可以提高网络整体的可扩展性。

# 以太坊的主要特点
+ 支持图灵完备的智能合约，设计了编程语言 Solidity 和虚拟机 EVM；
+ 选用了内存需求较高的哈希函数，避免出现强算力矿机、矿池攻击；
+ 叔块（Uncle Block）激励机制，降低矿池的优势，并减少区块产生间隔（10分钟降低到15秒左右）；
+ 采用账户系统和世界状态，而不是 UTXO，容易支持更复杂的逻辑；
+ 通过 Gas 限制代码执行指令数，避免循环执行攻击；
+ 支持 PoW 共识算法，并计划支持效率更高的 PoS 算法。

# 核心概念

## 智能合约
&emsp;&emsp;智能合约（Smart Contract）是以太坊中最为重要的一个概念，即以计算机程序的方式来缔结和运行各种合约。最早在上世纪 90 年代，Nick Szabo 等人就提出过类似的概念，但一直依赖因为缺乏可靠执行智能合约的环境，而被作为一种理论设计。区块链技术的出现，恰好补充了这一缺陷。
&emsp;&emsp;智能合约作为运行在以太坊虚拟机（Ethereum Virual Machine，EVM）中的应用，可以接受来自外部的交易请求和事件，通过触发运行提前编写好的代码逻辑，进一步生成新的交易和事件，可以进一步调用其它智能合约。智能合约的执行结果可能对以太坊网络上的账本状态进行更新。（可以参考存储过程来理解）

## 以太坊的账户分类
&emsp;&emsp;合约账户（Contracts Accounts）：存储执行的智能合约代码，只能被外部账户来调用激活；
&emsp;&emsp;外部账户（Externally Owned Accounts，或 EOA）：以太币拥有者账户，对应到某公钥；账户包括 nonce、balance、storageRoot、codeHash 等字段，由个人来控制。
&emsp;&emsp;当合约账户被调用时，存储其中的智能合约会在矿工处的虚拟机中自动执行，并消耗一定的燃料。燃料通过外部账户中的以太币进行购买。

## 交易
&emsp;&emsp;交易（Transaction），在以太坊中是指从一个账户到另一个账户的消息数据。消息数据可以是以太币或者合约执行参数。
&emsp;&emsp;以太坊采用交易作为执行操作的最小单位；类似比特币网络，在发送交易时，用户需要缴纳一定的交易费用，通过以太币方式进行支付和消耗。。每个交易包括如下字段：
+ to：目标账户地址。
+ value：可以指定转移的以太币数量。
+ nonce：交易相关的字串，用于防止交易被重放。
+ gasPrice：执行交易需要消耗的 Gas 价格。
+ startgas：交易消耗的最大 Gas 值。
+ signature：签名信息。

## 以太币
&emsp;&emsp;以太币（Ether）是以太坊网络中的货币。以太币主要用于购买燃料，支付给矿工，以维护以太坊网络运行智能合约的费用。以太币同样可以通过挖矿来生成，成功生成新区块的以太坊矿工可以获得5个以太币的奖励，以及包含在区块内交易的燃料费用。用户也可以通过交易市场来直接购买以太币。

## 燃料
&emsp;&emsp;燃料（Gas），控制某次交易执行指令的上限。每执行一条合约指令会消耗固定的燃料。当某个交易还未执行结束，而燃料消耗完时，合约执行终止并回滚状态。
&emsp;&emsp;Gas可以跟以太币进行兑换。需要注意的是，以太币的价格是波动的，但运行某段智能合约的燃料费用可以是固定的，通过设定Gas价格等进行调节。

# 智能合约相关设计

## 运行环境
&emsp;&emsp;以太坊采用以太坊虚拟机作为智能合约的运行环境。以太坊虚拟机是一个隔离的轻量级虚拟
机环境，运行在其中的智能合约代码无法访问本地网络、文件系统或其它进程。对同一个智能合约来说，往往需要在多个以太坊虚拟机中同时运行多份，以确保整个区块链数据的一致性和高度的容错性。

## 开发语言
&emsp;&emsp;目前 Solidity 是最常用的以太坊合约编写语言之一。智能合约编写完毕后，用编译器编译为以太坊虚拟机专用的二进制格式（EVM bytecode），由客户端上传到区块链当中，之后在矿工的以太坊虚拟机中执行。

## 交易模型
&emsp;&emsp;出于智能合约的便利考虑，以太坊采用了账户的模型，状态可以实时的保存到账户里，而无需像比特币的UXTO模型那样去回溯整个历史。
<img style="clear: both;display: block;margin:auto;" src="/img/2018/2018-06-05-13.jpg" width="85%">

# 开发工具

## 客户端和开发库
&emsp;&emsp;以太坊客户端可用于接入以太坊网络，进行账户管理、交易、挖矿、智能合约等各方面操作。以太坊社区现在提供了多种语言实现的客户端和开发库，支持标准的 JSON-RPC 协议。
+ go-ethereum：Go语言实现；
+ Parity：Rust 语言实现；
+ cpp-ethereum：C++ 语言实现；
+ ethereumjs-lib：javascript 语言实现；
+ Ethereum(J)：Java 语言实现；
+ ethereumH：Haskell 语言实现；
+ pyethapp：Python 语言实现；
+ ruby-ethereum：Ruby 语言实现。

## Geth
&emsp;&emsp;go-ethereum 的独立客户端 Geth 是最常用的以太坊客户端之一，Geth的使用需要基本的命令行基础，源码托管于 github.com/ethereum/go-ethereum；

## 以太坊钱包
&emsp;&emsp;对于只需进行账户管理、以太坊转账、DApp 使用等基本操作的用户，则可选择直观易用的钱包客户端。Mist 是官方提供的一套包含图形界面的钱包客户端，除了可用于进行交易，也支持直接编写和部署智能合约。

## IDE
+ Truffle：一个功能丰富的以太坊应用开发环境。
+ Embark：一个 DApp 开发框架，支持集成以太坊、IPFS 等。
+ Remix：一个用于编写 Solidity 的 IDE，内置调试器和测试环境。

## Geth的安装
```
# 首先安装必要的工具包。
$ apt-get install software-properties-common

# 之后用以下命令添加以太坊的源。
$ add-apt-repository -y ppa:ethereum/ethereum
$ apt-get update

# 最后安装 go-ethereum。
$ apt-get install ethereum

# 安装成功后，则可以开始使用命令行客户端 Geth。可用 geth --help 查看各命令和选项
# 例如，用以下命令可查看 Geth 版本为 1.6.1-stable。
$ geth version
Geth
Version: 1.6.1-stable
Git Commit: 021c3c281629baf2eae967dc2f0a7532ddfdc1fb
Architecture: amd64
Protocol Versions: [63 62]
Network Id: 1
Go Version: go1.8.1
Operating System: linux
GOPATH=
GOROOT=/usr/lib/go-1.8
```

# 智能合约的使用（等实测掌握了再补充吧...）
