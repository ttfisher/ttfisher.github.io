---
title: 网红技术区块链入门（二）：基本原理和核心技术概览
comments: true
categories:
  - Popular Technology - Blockchain
tags:
  - 区块链
abbrlink: eb342410
date: 2018-06-05 08:46:15
---
【引言】第一讲通过比特币入门，对区块链技术有了一个大概的了解，但是也就仅仅停留在概念阶段；那么这一讲，我们就开始探究一下区块链中比较深入的东西。
<div align=center><img src="/img/2018/2018-06-04-05.jpg" width="500"/></div>
<!-- more -->

# 定义和基本原理

## 基本定义
&emsp;&emsp;狭义上，区块链是一种以区块为基本单位的链式数据结构，区块中利用数字摘要对之前的交易历史进行校验，适合分布式记账场景下防篡改和可扩展性的需求。
&emsp;&emsp;广义上，区块链还指代基于区块链结构实现的分布式记账技术，还包括分布式共识、隐私与安全保护、点对点通信技术、网络协议、智能合约等。

## 基本原理
&emsp;&emsp;首先包括三个基本概念：
+ 交易（Transaction）：一次对账本的操作，导致账本状态的一次改变，如添加一条转账记录；
+ 区块（Block）：记录一段时间内发生的所有交易和状态结果，是对当前账本状态的一次共识；
+ 链（Chain）：由区块按照发生顺序串联而成，是整个账本状态变化的日志记录。

&emsp;&emsp;在实现上，首先假设存在一个分布式的数据记录账本，这个账本只允许添加、不允许删除。账本底层的基本结构是一个线性的链表，这也是其名字“区块链”的来源。链表由一个个“区块”串联组成（如下图所示），后继区块记录前导区块的哈希（Hash）值。新的数据要加入，必须放到一个新的区块中。而这个块（以及块里的交易）是否合法，可以通过计算哈希值的方式快速检验出来。任意维护节点都可以提议一个新的合法区块，然而必须经过一定的共识机制来对最终选择的区块达成一致。
<img style="clear: both;display: block;margin:auto;" src="/img/2018/2018-06-05-04.jpg" width="75%">

# 区块链的分类
根据参与者的不同，可以分为公有（Public）链、联盟（Consortium）链和私有（Private）链。
+ 公有链，顾名思义，任何人都可以参与使用和维护，典型的如比特币区块链，信息是完全公开的。
+ 如果进一步引入许可机制，可以实现私有链和联盟链两种类型。
 + 私有链，由集中管理者进行管理限制，只有内部少数人可以使用，信息不公开。
 + 联盟链，介于公有链和私有链两者之间，由若干组织一起合作维护一条区块链，该区块链的使用必须是带有权限的限制访问，相关信息会得到保护，典型如供应链机构或银行联盟。
 
# 区块链认识误区
&emsp;&emsp; 区块链不等于比特币。虽说区块链的基本思想诞生于比特币的设计中，但发展到今日，比特币和区块链已经俨然成为了两个不太相关的技术。前者更侧重从数字货币角度发掘比特币的实验性意义；后者则从技术层面探讨和研究可能带来的商业系统价值，试图在更多的场景下释放智能合约和分布式账本带来的科技潜力。
&emsp;&emsp; 区块链不等于数据库。虽然区块链也可以用来存储数据，但它要解决的核心问题是多方的互信问题。单纯从存储数据角度，它的效率可能不高，笔者也不推荐把大量的原始数据放到区块链系统上。当然，现在已有的区块链系统中，数据库相关的技术十分关键，直接决定了区块链系统的吞吐性能。

# 区块链技术的6大核心算法

## 拜占庭协定
&emsp;&emsp;拜占庭的故事大概是这么说的：拜占庭帝国拥有巨大的财富，周围10个邻邦垂诞已久，但拜占庭高墙耸立，固若金汤，没有一个单独的邻邦能够成功入侵。任何单个邻邦入侵的都会失败，同时也有可能自身被其他9个邻邦入侵。拜占庭帝国防御能力如此之强，至少要有十个邻邦中的一半以上同时进攻，才有可能攻破。然而，如果其中的一个或者几个邻邦本身答应好一起进攻，但实际过程出现背叛，那么入侵者可能都会被歼灭。于是每一方都小心行事，不敢轻易相信邻国。这就是拜占庭将军问题。
&emsp;&emsp;在这个分布式网络里：每个将军都有一份实时与其他将军同步的消息账本。账本里有每个将军的签名都是可以验证身份的。如果有哪些消息不一致，可以知道消息不一致的是哪些将军。尽管有消息不一致的，只要超过半数同意进攻，少数服从多数，共识达成。
&emsp;&emsp;由此，在一个分布式的系统中，尽管有坏人，坏人可以做任意事情(不受protocol限制)，比如不响应、发送错误信息、对不同节点发送不同决定、不同错误节点联合起来干坏事等等。但是，只要大多数人是好人，就完全有可能去中心化地实现共识

## 非对称加密技术
&emsp;&emsp;在上述拜占庭协定中，如果10个将军中的几个同时发起消息，势必会造成系统的混乱，造成各说各的攻击时间方案，行动难以一致。谁都可以发起进攻的信息，但由谁来发出呢?其实这只要加入一个成本就可以了，即：一段时间内只有一个节点可以传播信息。当某个节点发出统一进攻的消息后，各个节点收到发起者的消息必须签名盖章，确认各自的身份。
&emsp;&emsp;在如今看来，非对称加密技术完全可以解决这个签名问题。非对称加密算法的加密和解密使用不同的两个密钥.这两个密钥就是我们经常听到的”公钥”和”私钥”。公钥和私钥一般成对出现, 如果消息使用公钥加密,那么需要该公钥对应的私钥才能解密; 同样，如果消息使用私钥加密,那么需要该私钥对应的公钥才能解密。

## 容错问题
&emsp;&emsp;我们假设在此网络中，消息可能会丢失、损坏、延迟、重复发送，并且接受的顺序与发送的顺序不一致。此外，节点的行为可以是任意的：可以随时加入、退出网络，可以丢弃消息、伪造消息、停止工作等，还可能发生各种人为或非人为的故障。我们的算法对由共识节点组成的共识系统，提供的容错能力，这种容错能力同时包含安全性和可用性，并适用于任何网络环境。

## Paxos 算法(一致性算法)
&emsp;&emsp;在分布式系统中，一致性(Consistency，早期也叫 Agreement)是指对于系统中的多个服务节点，给定一系列操作，在协议（往往通过某种共识算法）保障下，试图使得它们对处理结果达成某种程度的一致。如果分布式系统能实现“一致”，对外就可以呈现为一个功能正常的，且性能和稳定性都要好很
多的“虚处理节点”。
> 注意：一致性并不代表结果正确与否，而是系统对外呈现的状态一致与否，例如，所有节点都达成失败状态也是一种一致。

&emsp;&emsp;理想的分布式系统一致性应该满足以下几点：
+ 可终止性（Termination）：一致的结果在有限时间内能完成；在计算机系统中，这个不是问题，因为这是计算机系统可以被使用的前提
+ 共识性（Consensus）：不同节点最终完成决策的结果应该相同；核心在于需要把两件事情进行排序，而且这个顺序还得是大家都认可的。
+ 合法性（Validity）：决策的结果必须是其它进程提出的提案；也就是达成的结果必须是节点执行操作的结果（不能自以为）。

&emsp;&emsp;Paxos算法解决的问题是一个分布式系统如何就某个值(决议)达成一致。一个典型的场景是，在一个分布式数据库系统中，如果各节点的初始状态一致，每个节点都执行相同的操作序列，那么他们最后能得到一个一致的状态。为保证每个节点执行相同的命令序列，需要在每一条指令上执行一个“一致性算法”以保证每个节点看到的指令一致。一个通用的一致性算法可以应用在许多场景中，是分布式计算中的重要问题。 节点通信存在两种模型：共享内存和消息传递。Paxos算法就是一种基于消息传递模型的一致性算法。

## 共识机制
&emsp;&emsp;区块链共识算法主要是工作量证明和权益证明。拿比特币来说，其实从技术角度来看可以把PoW看做重复使用的Hashcash，生成工作量证明在概率上来说是一个随机的过程。开采新的机密货币，生成区块时，必须得到所有参与者的同意，那矿工必须得到区块中所有数据的PoW工作证明。与此同时矿工还要时时观察调整这项工作的难度，因为对网络要求是平均每10分钟生成一个区块。

## 分布式存储
&emsp;&emsp;分布式存储是一种数据存储技术，通过网络使用每台机器上的磁盘空间，并将这些分散的存储资源构成一个虚拟的存储设备，数据分散的存储在网络中的各个角落。所以，分布式存储技术并不是每台电脑都存放完整的数据，而是把数据切割后存放在不同的电脑里。就像存放100个鸡蛋，不是放在同一个篮子里，而是分开放在不同的地方，加起来的总和是100个。
